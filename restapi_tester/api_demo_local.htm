<HTML>

<HEAD>
    <TITLE>test</TITLE>
    <base target="_blank" />
    <META http-equiv="Content-Type" content="text/html;" charset="UTF-8">
    <META name="viewport" content="width=device-witdh, initial-scale=1, maximum-scale=1, user-scale=0">



    <!--------->
    <!----------------------------------------------------------------------------->
    <!----------------------------------------------------------------------------->
    <script language="javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/jsencrypt/2.3.1/jsencrypt.min.js"></script>
    <script language="javascript" src="../jq/jquery.js"></script>

    <!----------------------------------------------------------------------------->
    <!------ api ---->
    <script src="https://bsnp21.github.io/home/js/config_websvr_data.js"></script>
    <script src="https://bsnp21.github.io/home/js/conf_svc_ip_addr.js"></script>
    <script src="https://bsnp21.github.io/home/js/BsnpSvc_IP_Info.js"></script>
    <script src="../np/js/BsnpRestApi.js"></script>
    <script src="../np/js/BsnpRestConst.js"></script>
    <!----------------------------------------------------------------------------->


    <style>
        body {
            background-color: aqua;
        }

        input {
            width: 500px;
        }

        .hili {
            background-color: red;
        }

        pre {
            border: 1px solid black;
            background-color: lightgray;
        }

        pre[contenteditable] {
            background-color: lightgreen;
        }

        pre.outp {

            background-color: antiquewhite;
        }
    </style>
    <script>



        $(function () {

            $("#passcode").on("click", function () {
                var usr = {}
                usr.repopath = $("#repopath").val()
                usr.passcode = $("#passcode").val()
                usr.ttl = $("#ttl").val()

                $("#usrobj").html("var usr=" + JSON.stringify(usr, null, 4))
            })

            $("#api_signin_ip").on("click", function () {

                $("#ret_signin").html("")
                $("#addur_ssid").attr("href", null).text("add SSID on url.")

                $(this).addClass("hili")
                var usr = {}
                usr.repopath = $("#repopath").val()
                usr.passcode = $("#passcode").val()
                usr.ttl = $("#ttl").val()

                var api = new BsnpRestApi()
                api.ApiUsrReposData_signin(usr, function (rob, err) {
                    $("#api_signin_ip").removeClass("hili")
                    console.log(rob)

                    $("#ret_signin").html(`ret = ${JSON.stringify(rob, null, 4)}`)
                    if (err) {
                        console.log(rob, ur)
                        alert("sorry, sign in failed.")
                    } else {
                        var ur = `${api.urlRedirectParam()}`
                        //alert("ok=\n" + ur)
                        $("#addur_ssid").attr("href", `${ur}`).text(ur);

                        console.log(rob, ur)

                    }
                })
            })

            $("#sign_out").on("click", function () {
                if (!confirm("Are you sure to sign out? \n\n (it could be destroyed permenantly).")) return;

                $(this).addClass("hili")
                var api = new BsnpRestApi()
                api.ajaxion(RestApi.ApiUsrReposData_destroy, {}, function (ret) {
                    //$("body").attr("onbeforeunload", null)
                    $("#sign_out").removeClass("hili").next().append(`<pre>${JSON.stringify(ret, null, 4)}</pre>`)
                    var urs = window.location.origin + window.location.pathname;
                    if (confirm("reset page?")) window.open(urs, "_self")
                })
            })

            gen_url_list();
            gen_api_sam()

            gen_BibleNames()
            gen_bibOjStdKeys()
        })


        function gen_api_sam() {
            var sample_apiPar = {
                ApiBibleObj_load_by_bibOj: [{ fnames: ['NIV', 'CUVS', 'e_v_CUVS_enn2'], bibOj: { Gen: { 1: { 1: '' } } } }],
                ApiBibleObj_write_Usr_BkcChpVrs_txt: [{ fnames: ['e_v_CUVS_enn2'], inpObj: { Gen: { '1': { '1': 'in the beginning' } } } }],
                ApiBibleObj_search_txt: [{ fnames: ['NIV', 'e_Note'], bibOj: { Gen: {} }, Search: { File: "NIV", Strn: "Melchizedek" } }],
                ApiUsrDat_load: [
                    {
                        fnames: ["./dat/MostRecentVerses"], //MyBiblicalDiary
                        data: {
                            "MostRecent_Searches": {},
                            "MostRecent_Verses": {},
                        }
                    },
                    {
                        fnames: ["./dat/MostRecentVerses"], //MyBiblicalDiary
                        data: {
                            "MostRecent_Searches": { MostRecentSearch: '', Group01: '' },
                            "MostRecent_Verses": {},
                        }
                    },
                    {
                        fnames: ["./dat/MyBiblicalDiary"], //MyBiblicalDiary
                        data: {
                            "2020": {},
                        }
                    }
                ],
                ApiUsrDat_save: [{
                    fnames: ["./dat/MostRecentVerses"], //MyBiblicalDiary
                    data: {
                        "MostRecent_Searches": {
                            Group01: [{ "Melchizedek": "1" }, { "x": "1" }],
                            Group02: [{ "Melchizedekxxx": "3000", "YHWH": "4000" }],
                            Group03: [{ "Melchizedekyyy": "5000", "YHWH": "6000" }]
                        },
                        "MostRecent_Verses": {
                            Group01: [{ "Gen30:1": "1000" }],
                            Group02: [{ "Gen3:1": "1000", "Gen4:1": "2000" }],
                            Group03: [{ "Gen5:1": "1000", "Gen6:1": "2000" }],
                            "MemoryVerse": [
                                {
                                    "Amo1:4": "221105 080029"
                                }
                            ],
                            "RecentTouch": [
                                {
                                    "Amo1:4": "221105 080029",
                                    "Gen1:4": "221105 080020"
                                }
                            ]
                        },
                    }
                },
                {
                    fnames: ["./dat/MyBiblicalDiary"], //MyBiblicalDiary
                    data: {
                        "2020": {
                            "0101": "new year eve"
                        }
                    }
                },
                ],
            }

            var lis = ""
            for (key in sample_apiPar) {
                var sam = ""
                sample_apiPar[key].forEach(function (obj) {
                    sam += `<pre contenteditable='true'>var par=${JSON.stringify(obj, null, 4)}</pre><button class='run_sam' apiId='${key}'>api.${key}(par, (ret)=>{});</button><pre class='outp'></pre>`
                })
                lis += `<li><h4>RestApi.${key}</h4>${sam}</li>`
            }
            $("#apiIdStr").html(lis)

            $(".run_sam").on("click", function () {
                var txt = $(this).prev().text().substr(8)
                var par = {}
                try {
                    par = JSON.parse(txt)
                } catch {
                    return alert("obj err:" + txt)
                }
                var sApiNameID = $(this).attr("apiId")
                var api = new BsnpRestApi()
                var _this = this
                $(_this).next().text('')
                api[sApiNameID](

                    par,
                    function (ret) {
                        console.log("ret", ret.out.data)
                        $(_this).next().text(`ret = ${JSON.stringify(ret, null, 4)}`)
                        if (ret.out.err) {
                            alert("load failed ret.out.err= " + ret.out.err)
                        }
                    })
            })
            //$("pre[contenteditable='true']").slideToggle()
            $("pre[contenteditable='true']").prev().on("click", function () {
                $(this).next().slideToggle()
            })
        }
        function gen_BibleNames() {
            var trs = ""
            var ar = Object.keys(CNST.FnameOfBibleObj).concat(["./dat/MostRecentVerses", "./dat/MyBiblicalDiary"])
            ar.forEach(function (key, i) {
                var stp = "<td>read</td><td></td><td>search</td>"
                if (key[0] === 'e') stp = "<td>read</td><td>write</td><td>search</td>"
                if (key[0] === '.') stp = "<td>read</td><td>write</td><td></td>"
                trs += `<tr><td>${i + 1}</td><td>${key}</td>${stp}</tr>`
            })

            $("#BibleNames").html(`<table border='1'>${trs}</table>`)
        }
        function gen_bibOjStdKeys() {
            var lis = ""
            for (key in CNST.BiBookName) {
                lis += `<li>${key}</li>`
            }
            $("#bibOjStdKeys").html(lis)

        }


        function get_test_list(urls) {
            var str = `<ol>
                        <li>Add to url params: <a href='?ip=${urls}'>?ip=${urls}</a><br></li>
                        <li>validatation check: <a href='${urls}'>${urls}</a></li>
                        <li>validatation check: <a href='${urls}/get_OTK'>${urls}/get_OTK</a></li>
                        </ol><br>
                        `
            return str;
        }
        function gen_url_list() {
            const chunk = (a, n) => [...Array(Math.ceil(a.length / n))].map((_, i) => a.slice(n * i, n + n * i));
            var chun = chunk(conf_svc_ip_addr, 2)
            var tita = {
                "Add to url params:": function (urls) { return `<a href='?ip=${urls}'>?ip=${urls}</a>` },
                "validatation check ip:": function (urls) { return `<a href='${urls}'>${urls}</a>` },
                "validatation check otk:": function (urls) { return `<a href='${urls}/get_OTK'>${urls}/get_OTK</a>`; },
            }
            var tr = "", idx = 0
            chun.forEach(function (ar2) {
                for (str in tita) {
                    tr += `<tr><td>${idx++}</td><td>${str}</td>`
                    ar2.forEach(function (ip) {
                        tr += `<td>${tita[str](ip)}</td>`
                    })
                    tr += "</tr>"
                }
            })

            $("#tbd").html(tr).find("td").on("click", function () {
                $(this).toggleClass("hili")
            })
            console.log()
        }
    </script>





    <script>
        function gen_host() {
            // href="http://34.227.20.213/wdaws/bb/np/mySignIn.htm?ip=http://34.227.20.213:7778"
            ///href="http://34.227.20.213/wdaws/bb/np/mySignIn.htm?ip=http://34.227.20.213:7778&rep=https://wdingsoft@bitbucket.org/bsnp21/guest_01.git&pat=&opt="
            // hostipaddress list.
            // svr ip list (including githut.io)
            // svr port https or http. 
            var Hostary = ["https://bsnp21.github.io/bb/np/mySignIn.htm"];
            Object.keys(BsnpSvc_IP_Info.ip).forEach(function (ip) {
                Hostary.push(`http://${ip}/wdaws/bb/np/mySignIn.htm`)
            })
            console.log(Hostary)
            var str = ""
            Hostary.forEach(function (key, i) {
                str += `<tr><td class='host'>${key}</td></tr>`
            })
            $("#hostaddr").html(str)
            $(".host").on("click",function(){
                $(".host.hili").removeClass("hili")
                $(this).addClass("hili")
                gen_link()
            })
        }
        function gen_svc(){
            var protocal = $(".protocal.hili").text().trim()
            var str = ""
            Object.keys(BsnpSvc_IP_Info.ip).forEach(function (ip) {
                var par = `?ip=${protocal}://${ip}:${BsnpSvc_IP_Info[protocal]}`
                str += `<tr><td class='svc'>${par}</td></tr>`
            })
            $("#svcaddr").html(str)
            $(".svc").on("click",function(){
                $(".svc.hili").removeClass("hili")
                $(this).addClass("hili")
                gen_link()
            })
        }
        function gen_sam_usr(){
            var pwd = ["gSzk","TPg","FNnz9v","5wGF","5eN"].join("")
            var str="<tr><td class='sam hili'>&n=p</td></tr>"
            for(var i=1;i<=2;i++){
                var par = `&rep=https://wdingsoft@bitbucket.org/bsnp21/guest_0${i}.git&pat=${pwd}`
                str+=`<tr><td class='sam'>${par}</td></tr>`
            }
            $("#sam").html(str)
            $(".sam").on("click",function(){
                $(".sam.hili").removeClass("hili")
                $(this).addClass("hili")
                gen_link()
            })
            
        }
        function gen_link(){
            var str=$(".host.hili").text()
            str+=$(".svc.hili").text()
            str+=$(".sam.hili").text()
            $("#linkstr").attr("href", str).text(str)
        }
        $(function () {
            gen_host()
            gen_svc()
            gen_sam_usr()
            $(".protocal").on("click",function(){
                $(".protocal.hili").removeClass("hili")
                $(this).addClass("hili")
                gen_svc()
            })
            
        })
    </script>
</HEAD>

<BODY>
    <h1>BsnpRestApi Demo Usage</h1>
    <ol>
        <li>
            <h3>The includes in head</h3>


            <pre>
        <!-------------------------------------------------------------------------------->
        &lt;script language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsencrypt/2.3.1/jsencrypt.min.js"></script>
        &lt;script language="javascript" src="../jq/jquery.js"></script>
    
        <!------------------------------------api----------------------------------------->
       
        &lt;script src="https://bsnp21.github.io/bb/np/js/BsnpRestApi.js"></script>
        &lt;script src="../np/js/BsnpRestConst.js"></script>
        <!-------------------------------------------------------------------------------->
        </pre>
        </li>






        <li>
            <h3 id="">Select api IP addr for url param</h3>

            <table note="frame">
                <tr>
                    <td>
                        <table border="1">
                            <caption>Host Signin</caption>
                            <tbody id="hostaddr"></tbody>
                        </table>
                    </td>
                  
                    <td>
                        <table border="1">
                            <caption> Svc:<button class="protocal hili">http</button>
                                <button class="protocal">https</button></caption>
                            <tbody id="svcaddr"></tbody>
                        </table>
                    </td>
                    <td>
                        <table border="1">
                            <caption>Sample</caption>
                            <tbody id="sam"></tbody>
                        </table>
                    </td>
                </tr>
                <tr><td colspan="3"><a id="linkstr"></a></td></tr>
            </table>
            <table>

            </table>

            <pre>
                &lt;script src="https://bsnp21.github.io/home/js/config_websvr_data.js"></script>
            </pre>
            <ol id="urlist">

            </ol>
            <table border="1">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Desc</th>
                        <th>HTTP</th>
                        <th>HTTPS</th>
                    </tr>
                </thead>
                <tbody id="tbd"></tbody>
            </table>
        </li>



        <li>
            <h3>Repository</h3>
            repopath:<input id="repopath" value="https://wdingsoft@bitbucket.org/bsnp21/guest_02.git"></input><br>
            passcode:<input id="passcode" value="gSzk" val2="TPgFNnz" v3="9v5wGF5eN"
                onclick="$(this).val('gSzk'+'TPgFNnz'+'9v5wGF5eN')"></input><br>
            <a onclick="$(this).next().val(1)">TTL:</a> <input id="ttl" value="9999"></input>
            <pre id="usrobj"></pre>
        </li>

        <li>
            <h3 id="">Signin</h3>

            <pre id="api_signin_ip">
                    var api = new BsnpRestApi()
                    api.ApiUsrReposData_signin(usr, function (ret, err){});
                </pre>
            <a id="addur_ssid">add SSID on url param</a>
            <pre class="outp" id="ret_signin"></pre>
            <br>
        </li>

        <li>
            <h3>Sign out</h3>
            <pre id="sign_out">
                api.ApiUsrReposData_destroy({}, (ret)=>{})
            </pre><a>..</a>
        </li>
        <li>
            <h3>BsnpRestApi.ajaxion </h3>
            <ol id="apiIdStr">
            </ol>
        </li>
        <li>
            <h3>Available fnames or Research.File </h3>
            <ol id="BibleNames">
            </ol>
        </li>
        <li>
            <h3>bibOj std keys</h3>
            <ol id="bibOjStdKeys"></ol>
        </li>
    </ol>

</BODY>

</HTML>