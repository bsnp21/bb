<html>

<head>
    <title>~</title>
    <META http-equiv="Content-Type" content="text/html;" charset="UTF-8">
    <base target="_blank" />
    <META name="viewport" content="width=device-witdh, initial-scale=1, maximum-scale=1, user-scale=0">

    <!-------------------------------------------->
    <!---- Insert this before scripts import; then restor back later -->
    <script>//if (typeof module === 'object') { window.module = module; module = undefined; }</script>

    <!-------------- jq --------------------->
    <script ____src="./doc_files/jquery-2_1_3.min.js"></script>
    <script src="https://wdingbox.github.io/ham12/jq/jquery-2_1_3.min.js"></script>
    <script xxxxxxxsrc="http://localhost:7878/assets/ckeditor/adapters/jq/jquery-2_1_3.min.js"
        note="selfseversite"></script>
    <!-------------- ckeditor only--------------------->
    <script xxxxxxxxxxxsrc="../../../assets/ckeditor/ckeditor.js"></script>


    <!-------------------------------------------->
    <script src="./js/BsnpRestApi.js"></script>
    <script src="./js/BsnpRestConst.js"></script>
    <script src="./js/UtiLib.js"></script>
    <script src="./js/PageUti.js"></script>
    <script src="./js/MyStorage.js"></script>
    <script src="./BibleStudyNotePad.js?v=20.12.4" language="javascript"></script>

    <script language="javascript"
        src="https://wdingbox.github.io/bible_obj_lib/jsdb/jsBibleStruct/All_Max_struct_json.js"></script>
    <script src="https://bsnpghrepolist.github.io/admin/account/myoj/e_Note_json.js"></script>
    <!----- Insert this line after script imports -->
    <script>//if (window.module) module = window.module;</script>
    <!-------------------------------------------->
    <style>
        #ctrpanel {
            z-index: 999999;
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: antiquewhite;
        }

        #input,
        #output {
            background-color: black;
            color: white;
            overflow: auto
        }


        #idbtn_exec_cmd {
            background-color: grey;
        }

        .white_space_nowrap {
            white-space: nowrap;
        }

        .editorinfo {
            background-color: lightblue;
            display: inline-block;
            white-space: nowrap;
            width: 100%;
        }

        .minitxt {
            float: left;
            white-space: nowrap;
        }

        .minicon {
            float: right;

            white-space: nowrap;
        }

        .scorenum {
            float: right;
            white-space: nowrap;
        }

        .usrbar {
            background-color: rgb(94, 135, 172);
        }


        .heart {
            float: right;
            padding: 0 10px 0 10px;
        }

        .heart_grey {
            color: gray;
        }

        .heart_red {
            color: red;
        }
    </style>
</head>

<body onbeforeunload="return 'leave?';">
    <div id="ctrpanel">
        <a id="usrname">usrname</a>
    </div>






    <h></h><input id="inpBCV" placeholder="Fellowship Group ID"></input> <button id="runCmd">Search</button>
    <div id="account_history"></div>

    <table border="1">
        <caption id="scap"></caption>
        <tbody id="allusrs">

        </tbody>
    </table>





    <script>


    </script>
</body>

</html>
<script>
    if ("undefined" === typeof localStorage) {
        alert("localStorage not supported")
    }
</script>
<script>
    function getvrs(bcv, objSrc) {
        var retOj = Uti.parse_bcv(bcv, "")
        Uti.FetchObj_UntilEnd(retOj.bcvObj, objSrc)
        var str = retOj.get_vrs()
        return str
    }
    function jster_obj(usrname) {
        var urls = `https://bsnpghrepolist.github.io/${usrname}/myoj/e_Note_json.js`
        var scst = "<" + "script " + "src=\'" + urls + "\'/>"
        $("head").append(scst)
        console.log(urls)
    }
    function get_usr_urls(usrname) {
        var urls = `https://bsnpghrepolist.github.io/${usrname}/myoj/e_Note_json.js`
        return urls;
    }
    $(function () {
        var urls = window.location.href;
        var param = new URLSearchParams(urls)
        $("#usrname").text(param.get("SSID").slice(13))
        var bcv = param.get("BCV")
        $("#inpBCV").val(bcv)

        /////////
        ajx_gen_table(bcv)
    })
    function ajx_gen_table(bcv) {
        var trs = ""
        var str = getvrs(bcv, e_Note_json)
        str.split(",").forEach(function (usrnam) {
            trs += `<tr><td><div class='usrbar'><a class='usrnamelabel'>${usrnam}</a><a class='heart'>&#9829;</a></div><div id='${usrnam}_note'></div> </td></tr>`
        })
        $("#allusrs").html(trs)
        $(".usrnamelabel").on("click", function () {
            var usrname = $(this).text()
            var urls = get_usr_urls(usrname)
            $.get(urls, function (dat, err) {
                console.log(err)
                var obj = JSON.parse(dat.slice(dat.indexOf("{")))
                var vrs = getvrs(bcv, obj)
                $(`#${usrname}_note`).html(vrs)
            })
        })
    }
    function api_gen_table(bcv) {
        var api = new BsnpRestApi()
        var retOj = Uti.parse_bcv(bcv, "")
        var par = { fnames: ["e_Note"] }
        par.inpObj = retOj.bcvObj
        api.ApiBibleObj_read_crossnetwork_BkcChpVrs_txt(par, function (rob) {
            console.log(rob)
            gen_table(rob.out.data)
        })

        ///
        function gen_table(obj) {
            var slst = ""
            Object.keys(obj).forEach(function (key, i) {

                slst += `<tr><td>${i}</td><td><div class='usrbar'><a class='usrname'>${key}</a><a class='heart'>&#9829;</a></div>
                <div class='enote' urls='${key}'>${obj[key]}</div></td></tr>`
            })
            $("#allusrs").html(slst)
            $(".heart").on("click", function () {
                $(this).toggleClass("heart_red")
            })
            $(".enote").on("click", function () {
                var url = get_usr_urls($(this).attr("urls"))
                $.get(url, function (dat, stat) {
                    console.log(dat, stat)

                })
            })

        }
    }

</script>