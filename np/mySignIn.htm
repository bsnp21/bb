<html>

<head>
    <title>sign-in</title>
    <base target="xxx_blank" />
    <META http-equiv="Content-Type" content="text/html;" charset="UTF-8">
    <META name="viewport" content="width=device-witdh, initial-scale=1, maximum-scale=1, user-scale=0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsencrypt/2.3.1/jsencrypt.min.js"></script>

    <script src="https://bsnp21.github.io/home/js/quotestr.js"></script>
    <link rel="stylesheet" href="https://bsnp21.github.io/home/css/index.css">
    </link>




    <!-------------------------------------------->
    <!---- Insert this before scripts import; then restor back later -->
    <script>//if (typeof module === 'object') { window.module = module; module = undefined; }</script>

    <!-------------- jq --------------------->
    <script ____src="./doc_files/jquery-2_1_3.min.js"></script>
    <script src="https://wdingbox.github.io/ham12/jq/jquery-2_1_3.min.js"></script>


    <script src="./js/CNST.js"></script>
    <script src="./js/UtiLib.js"></script>
    <script src="./js/PageUti.js"></script>
    <script src="./js/MyStorage.js"></script>

    <script src="./js/BsnpRestApi.js"></script>
    <script language="javascript" src="./BibleStudyNotePad.js?v=20.12.4"></script>
    <!-------------------------------------------->

    <!-------------------------------------------->
    <style>
        body {
            background-color: aliceblue;
            margin: 0px 0px 0px 0px;
            padding: 0px 0px 0px 0px;
            width: 100%;
        }

        form {
            background-color: rgb(204, 177, 161);


            margin: 0px 10px 0px 10px;
            padding: 1px 10px 0px 10px;
        }

        .centered_elem {
            display: block;
            margin-left: auto;
            margin-right: auto;
            background-color: rgb(204, 177, 161);

            text-align: center;
            margin: 0px 10px 0px 10px;
            padding: 0px 10px 10px 10px;
        }

        .center,
        table {

            margin-left: auto;
            margin-right: auto;

        }


        xtable {
            padding: 10px 10px 10px 10px;
            margin: 10px 10px 10px 10px;
            /*font-size:xx-large;*/
        }

        .white_space_nowrap {
            white-space: nowrap;
        }

        textarea,
        .txarea {
            width: 100%;
        }

        textarea,
        input {
            font-size: large;
        }

        .HiliFocused {
            background-color: #e7f1ad;
        }

        .deleted_repo {
            text-decoration: line-through;
        }

        .help_label {
            float: right;
        }

        .helpinfo,
        #FormatOfRepository {
            display: none;
            margin-left: 1px;
        }

        .centeredtxt {
            text-align: center;
            margin-left: auto;
            margin-right: auto;
            width: 70%;
        }
    </style>
</head>

<body>

    <h2 style="text-align: center;margin-top: 10px;"><a href="https://bsnp21.github.io/home/">Bible Study Note Pad</a>
    </h2>

    <h3 id="Enter" style="text-align: center;margin-top: 10px;">Sign-in Page</h3>
    <div id="output" style="text-align: center;margin-top: 10px;">.</div>












    <div id="input_area">
        <form action="">
            <h3 style="text-align: center;margin-top: 10px;" id="GitInfo">Git Info</h3>






            <div>
                <a id="">Git Repository HTTPS URL:</a> (<font color='red'>required</font>)

                <div class="help_label">
                    <a class="" id="Format_Check">Format</a> |
                    <a class="" onclick="$('.helpinfo.Repository').toggle('slow');">help?</a>
                </div>

            </div>
            <div class="helpinfo Repository" id="help_Repository">
            </div>


            <div>
                <textarea id="repopath" maxlength="120" class="inputxt" value=""
                    placeholder="https://github.com/username/reposname.git">https://github.com/bsnp21/pub_test.git</textarea>
            </div>







            <br>

            <div>
                <a for="editor1" id="label_password">Git Personal-Access-Token</a> :
                (<a style="color:red;" id="required_password_test">required</a>)


                <a class="help_label" onclick="$('.helpinfo.Password').toggle('slow');">help?</a>
                <a class="help_label"> &nbsp; | &nbsp; </a>
                <a class="help_label" onclick="$('#passcode').val('')"> [X] </a>
            </div>
            <div class="helpinfo Password">
            </div>
            <textarea id="passcode" type="password" maxlength="120" style="width:100%;" class="inputxt"
                value=""></textarea>

            <br>
            <hr />
            <br>
        </form>
        <div class="centered_elem">


            <button class="signinBtn" id="signInAsUsers" title="sign-n to endorse" disabled>Sign-in</button>
            <a id="CheckIn">&nbsp;&nbsp;&nbsp; check-in </a>
            <br>
            <font color='red'><a id="errmsg"></a></font>
            <div style="float:right;">


                <a id='Test' onclick="$('#testPanel').toggle();">.</a>
            </div>
        </div>
    </div>

    <div style="text-align: center;margin-top: 0px;" onclick="$('#txtarea').val('');" id="otb">...</div>
    <div id="account_history" class="center" style="display: none;">.</div>





    <hr id="toggle_txtarea">

    <div id="footer" style="text-align: center;margin-top: 50px;">
        <textarea id="txtarea" rows="25"></textarea>
    </div>

</body>

</html>
<script>

    $(function () {


        $("#txtarea").hide()
        $("#toggle_txtarea").on("click", function () {
            $("#txtarea").toggle()
        })

        $("#label_password").on("click", function () {
            var typns = $("#passcode").attr("type")
            typns = ("password" === typns) ? "text" : "password"
            $("#passcode").attr("type", typns)
        })

        $("#required_password_test").on("click", function () {
            var repopath = $("#repopath").val()
            var ret = Uti.validate_repository_url(repopath)
            $("#passcode").val(ret.repo)
        })



        $(".inputxt").on("focus", function () {
            $(".HiliFocused").removeClass('HiliFocused')
            $(this).addClass("HiliFocused")
        }).on("blur", function () {
            //$(this).removeClass("HiliFocused")
            $(".HiliFocused").removeClass('HiliFocused')
        })

        $("#GitInfo").on("click", function () {
            PageUti.Repositories_History("#account_history", 1)
        }).on("blur", function () {
            //PageUti.Repositories_History("#account_history", 0)
        })

        $("#repodesc").on("focus", function () {
            //PageUti.Repositories_History("#account_history", 2)
        })
        $("#passcode").on("focus", function () {
            //PageUti.Repositories_History("#account_history", -1)
        })



        $("#respdesc_history").on("click", function () {
            PageUti.Repositories_History("#account_history", 2)
        })

        Uti.visual_check_repository("#Format_Check")



    })
</script>
<script>
    $(function () {

        PageUti.Repositories_History("#account_history", 1)
        PageUti.Repositories_History("#account_history", -1)

        $("#otb").on("click", function () {
            PageUti.Repositories_History("#account_history", 1)
        })

        $(".signinBtn").removeAttr("disabled")

        $("#signInAsUsers").on("click", function () {
            sign_in(function (rob, ur) {
                window.open(ur, '_self');
            }, failure)
        })

        $("#CheckIn").on("click", function () {
            $(this).toggle("slow")
            var paths = $("#repopath").val()
            sign_in(function (rob, ur) {
                var tb = PageUti.Repo_fstat_table(rob)
                MyStorage.SSID(rob.out.state.SSID)
                var a = `<a href='${ur}' target="_self">Successfully checked in<br>${paths} <br>click here to continue to log in</a>`
                $("#Enter").html(a)
                $("#output").html(tb)
                $("#input_area, #account_history_table").hide()
            }, failure)
        })

    })
    function sign_in(success, failed) {
        $(".signinBtn").attr("disabled", true)
        $("#errmsg").text("runing ...")
        var api = new BsnpRestApi()
        var usr = MyStorage.Repositories().repos_app_update()
        var par = { usr: usr, aux: { cacheTTL: 36000 } }
        api.signin(par, function (rob, err) {
            $(".signinBtn").removeAttr("disabled")
            console.log(rob)
            var ur = `./BibleStudyNotePad.htm${api.urlRedirectParam()}`

            if (err) {
                failed(rob, ur)
            } else {
                success(rob, ur)

            }

        })
    }
    $("#errmsg").on("click", function () {
        $("*[disabled").removeAttr("disabled")
        $("#CheckIn").show("slow")
    })
    function failure() {
        $("#errmsg").text("failed to sign in.")
    }


</script>